# Example 1: Merge two CSVs

This example shows how to merge two CSV files into one. Let's say you have two CSV files, one with order details and
another with customer details. You want to generate a single file for customer's orders by joining data from both the
files.

File 1: orders.csv

| order_id | customer_id | order_date | total_amount |
|:---------|-------------|------------|--------------|
| 101      | 12          | 12-09-2023 | 234          |
| 102      | 13          | 12-09-2023 | 198          |
| 103      | 12          | 13-09-2023 | 789          |
| 104      | 15          | 13-09-2023 | 236          |
| 105      | 10          | 15-09-2023 | 100          |

File 2: customers.csv

| customer_id | customer_name  | customer_email           | customer_address                  |
|-------------|----------------|--------------------------|-----------------------------------|
| 10          | Andrew Symonds | andrew.symonds@ingen.com | 1C 104, Viviana Villas, Riverdale |
| 11          | Lilly Charms   | lilly.charms@ingen.com   | 12B, Westwoods, Hillcrest         |
| 12          | Pat Ronald     | pat.ronald@ingen.com     | C-2, Green woods, Pinehurst       |
| 13          | Mathew Josh    | matt.josh@ingen.com      | 112, Amar Heights, Oakwood        |
| 14          | Elizabeth      | elli@ingen.com           | 23, South Park, Amsteryork        |
| 15          | Rahul Bajaj    | rahul.bajaj@ingen.com    | 14, Indiana Heights, New Town     |

In the output file we want to print customer's order details along with their name and address. So the output file will
look like this:

| order_id | customer_id | order_date | total_amount | customer_name  | customer_address                  |
|:---------|-------------|------------|--------------|----------------|-----------------------------------|
| 101      | 12          | 12-09-2023 | 234          | Pat Ronald     | C-2, Green woods, Pinehurst       |
| 102      | 13          | 12-09-2023 | 198          | Mathew Josh    | 112, Amar Heights, Oakwood        |
| 103      | 12          | 13-09-2023 | 789          | Pat Ronald     | C-2, Green woods, Pinehurst       |
| 104      | 15          | 13-09-2023 | 236          | Rahul Bajaj    | 14, Indiana Heights, New Town     |
| 105      | 10          | 15-09-2023 | 100          | Andrew Symonds | 1C 104, Viviana Villas, Riverdale |


## Sources
For a CSV file, we declare a `file` type source and its properties like `file_type`, `file_path` and its `columns`. The 
following code snippet lists our two example sources:

```yaml
sources:
  - id: orders
    type: file
    file_type: delimited_file
    file_path: orders.csv
    columns: [order_id, customer_id, order_date, total_amount]
    skip_header_size: 1
  - id: customers
    type: file
    file_type: delimited_file
    file_path: customers.csv
    columns: [customer_id, customer_name, customer_email, customer_address]
    skip_header_size: 1
```
The property `skip_header_size` accepts the number of rows to ignore from the top of the CSV file. Setting it to 1 will
ignore the first row which is the header - names of the columns. If your csv file does not contain the header row, you 
can skip this field.

## Interfaces
The output generated by running InterfaceGenerator is called an interface, in our example it is a CSV file created using
the two data sources we defined above. This requires defining the ids of the data sources, any pre-processing required 
to combine the data sources, list of columns required in the final file and properties of the output file.

```yaml
interfaces:
  customer_orders:
    sources: [orders, customers]
    pre_processing:
      - type: merge
        source: customers
        left_key: customer_id
        right_key: customer_id
        merge_type: left
```
In the above example, we have declared the ids of the two data sources. The first element of this array is important, 
because this data source is the input to the pre_processing steps. Here, `orders` data source is merged with `customers`
data source on the basis of `customer_id` column, which is present in both of them. The name of the columns by which the
data sources are merged can be different and are defined by the `left_key` and the `right_key`. `merge_type` can be one of
`left`, `right` or `inner`. This key defines how the two source should be merged (joined). This is similar to a relational
database's left join, right join and inner join. 

Let's define the columns we want in the final output:

```yaml
    columns:
      - src_col_name: order_id
      - src_col_name: customer_id
      - src_col_name: order_date
      - src_col_name: total_amount
      - src_col_name: customer_name
      - src_col_name: customer_address
```

Finally, let's add the output file properties:

```yaml
    output:
        type: delimited_file
        props:
            delimiter: '|'
            path: customer_orders.psv
            header:
              type: delimited_result_header
```

The output will be written to a file called `customer_orders.psv` which is a pipe separated file. The file will also 
contain a header row, which will be just the column names in our example. 

Here's the complete yaml file with interface and source definition:
```yaml
interfaces:
  customer_orders:
    sources: [orders, customers]
    pre_processing:
      - type: merge
        source: customers
        left_key: customer_id
        right_key: customer_id
        merge_type: left
    columns:
      - src_col_name: order_id
      - src_col_name: customer_id
      - src_col_name: order_date
      - src_col_name: total_amount
      - src_col_name: customer_name
      - src_col_name: customer_address
    output:
      type: delimited_file
      props:
        delimiter: '|'
        path: customer_orders.psv
        header:
          type: delimited_result_header
sources:
  - id: orders
    type: file
    file_type: delimited_file
    file_path: orders.csv
    columns: [order_id, customer_id, order_date, total_amount]
    skip_header_size: 1
  - id: customers
    type: file
    file_type: delimited_file
    file_path: customers.csv
    columns: [customer_id, customer_name, customer_email, customer_address]
    skip_header_size: 1
```

